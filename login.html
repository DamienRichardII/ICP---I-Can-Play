<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICP — Connexion</title>
  <meta name="description" content="Connexion — ICP." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:Inter,system-ui,sans-serif;}
    a{text-decoration:none;color:inherit}

    .lp-root{
      min-height:100dvh;
      display:grid;
      grid-template-columns:1fr 1fr;
      background:#0a0a0a;
    }

    /* ── LEFT ── */
    .lp-left{position:relative;overflow:hidden;}
    .lp-left-img{
      position:absolute;inset:0;
      background:url('assets/login-bg.jpg') center/cover no-repeat;
      transform:scale(1.04);
      filter:saturate(1.08) contrast(1.04);
      transition:transform 8s ease;
    }
    .lp-root:hover .lp-left-img{transform:scale(1.00);}
    .lp-left-overlay{
      position:absolute;inset:0;
      background:
        linear-gradient(135deg,rgba(0,0,0,.55) 0%,rgba(0,0,0,.18) 50%,rgba(0,0,0,.65) 100%),
        linear-gradient(180deg,rgba(0,0,0,.28) 0%,rgba(0,0,0,.72) 100%);
    }
    .lp-left-content{
      position:relative;z-index:2;height:100%;
      display:flex;flex-direction:column;justify-content:space-between;
      padding:36px 40px 40px;
    }
    .lp-left-logo img{height:44px;width:auto;border-radius:12px;display:block;}
    .lp-left-quote blockquote{
      margin:0 0 16px;
      font-weight:900;font-size:clamp(26px,2.8vw,40px);
      letter-spacing:-.01em;line-height:1.08;
      text-transform:uppercase;color:#fff;
      text-shadow:0 16px 48px rgba(0,0,0,.5);
    }
    .lp-left-quote p{margin:0;color:rgba(255,255,255,.62);font-size:14px;font-weight:500;}
    .lp-left-badges{display:flex;gap:10px;flex-wrap:wrap;}
    .lp-badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:8px 14px;border-radius:999px;
      background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);
      color:rgba(255,255,255,.88);font-size:11px;font-weight:800;
      letter-spacing:.12em;text-transform:uppercase;backdrop-filter:blur(8px);
    }
    .lp-badge-dot{width:6px;height:6px;border-radius:50%;background:#4ade80;flex-shrink:0;}

    /* ── RIGHT ── */
    .lp-right{
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      background:#0f0f0f;padding:48px 24px;min-height:100dvh;
    }
    .lp-right-inner{width:100%;max-width:400px;}
    .lp-topnav{display:flex;justify-content:space-between;align-items:center;margin-bottom:48px;}
    .lp-back{
      display:inline-flex;align-items:center;gap:8px;
      color:rgba(255,255,255,.40);font-size:12px;font-weight:700;
      letter-spacing:.10em;text-transform:uppercase;transition:color .15s;
    }
    .lp-back:hover{color:rgba(255,255,255,.78);}

    /* ── TABS (Login / Créer un compte) ── */
    .lp-tabs{
      display:flex;gap:0;
      background:rgba(255,255,255,.06);
      border-radius:14px;border:1px solid rgba(255,255,255,.08);
      padding:4px;margin-bottom:36px;
    }
    .lp-tab{
      flex:1;height:38px;border-radius:10px;border:none;
      background:transparent;
      color:rgba(255,255,255,.38);font:inherit;
      font-size:12px;font-weight:800;letter-spacing:.10em;text-transform:uppercase;
      cursor:pointer;transition:background .18s,color .18s;
    }
    .lp-tab.is-active{
      background:rgba(255,255,255,.12);
      color:#fff;
    }

    /* ── PANELS ── */
    .lp-panel{display:none;}
    .lp-panel.is-active{display:block;}

    .lp-form-header{margin-bottom:28px;}
    .lp-eyebrow{font-size:11px;font-weight:800;letter-spacing:.18em;text-transform:uppercase;color:rgba(255,255,255,.28);margin-bottom:8px;}
    .lp-form-title{font-weight:900;font-size:28px;letter-spacing:-.02em;color:#fff;line-height:1.08;margin-bottom:6px;}
    .lp-form-sub{color:rgba(255,255,255,.36);font-size:13px;font-weight:500;line-height:1.5;}

    .lp-form{display:grid;gap:14px;}
    .lp-field{display:grid;gap:7px;}
    .lp-label{font-size:11px;font-weight:800;letter-spacing:.10em;text-transform:uppercase;color:rgba(255,255,255,.36);}
    .lp-input-wrap{position:relative;}
    .lp-input-wrap > svg{
      position:absolute;left:14px;top:50%;transform:translateY(-50%);
      width:15px;height:15px;color:rgba(255,255,255,.24);pointer-events:none;
    }
    .lp-input{
      width:100%;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      padding:13px 42px 13px 40px;
      font:inherit;font-size:14px;color:#fff;outline:none;
      transition:border-color .15s,background .15s,box-shadow .15s;
    }
    .lp-input::placeholder{color:rgba(255,255,255,.22);}
    .lp-input:focus{
      border-color:rgba(255,255,255,.26);
      background:rgba(255,255,255,.09);
      box-shadow:0 0 0 3px rgba(255,255,255,.05);
    }
    .lp-input.is-error{border-color:rgba(255,80,80,.5);}
    .lp-eye{
      position:absolute;right:12px;top:50%;transform:translateY(-50%);
      background:none;border:none;padding:4px;cursor:pointer;
      color:rgba(255,255,255,.26);transition:color .15s;
      display:flex;align-items:center;
    }
    .lp-eye:hover{color:rgba(255,255,255,.58);}
    .lp-eye svg{width:15px;height:15px;}

    .lp-options{display:flex;justify-content:space-between;align-items:center;margin-top:2px;}
    .lp-remember{
      display:flex;align-items:center;gap:8px;
      font-size:12px;font-weight:600;color:rgba(255,255,255,.36);
      cursor:pointer;user-select:none;
    }
    .lp-remember input[type="checkbox"]{
      appearance:none;-webkit-appearance:none;
      width:15px;height:15px;border-radius:4px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      cursor:pointer;position:relative;flex-shrink:0;transition:background .15s;
    }
    .lp-remember input[type="checkbox"]:checked{background:#fff;border-color:#fff;}
    .lp-remember input[type="checkbox"]:checked::after{
      content:"";position:absolute;inset:0;
      background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 10'%3E%3Cpath d='M1 5l3 4L11 1' fill='none' stroke='%23111' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") center/9px no-repeat;
    }
    .lp-forgot{font-size:12px;font-weight:700;color:rgba(255,255,255,.32);letter-spacing:.04em;transition:color .15s;}
    .lp-forgot:hover{color:rgba(255,255,255,.68);}

    .lp-submit{
      width:100%;height:50px;border-radius:12px;border:none;
      background:#fff;color:#0a0a0a;
      font:inherit;font-size:13px;font-weight:900;letter-spacing:.12em;text-transform:uppercase;
      cursor:pointer;margin-top:4px;
      transition:background .15s,transform .15s,box-shadow .15s,opacity .15s;
      box-shadow:0 14px 40px rgba(0,0,0,.4);position:relative;overflow:hidden;
    }
    .lp-submit:hover{background:#f0f0f0;transform:translateY(-1px);box-shadow:0 18px 54px rgba(0,0,0,.5);}
    .lp-submit:active{transform:translateY(0);}
    .lp-submit:disabled{opacity:.45;cursor:not-allowed;transform:none;}

    .lp-divider{
      display:flex;align-items:center;gap:14px;
      color:rgba(255,255,255,.18);font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;
      margin:2px 0;
    }
    .lp-divider::before,.lp-divider::after{content:"";flex:1;height:1px;background:rgba(255,255,255,.10);}

    .lp-sso{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .lp-sso-btn{
      height:46px;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      color:rgba(255,255,255,.62);
      font:inherit;font-size:12px;font-weight:700;letter-spacing:.06em;
      cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;
      transition:background .15s,border-color .15s,transform .15s;
    }
    .lp-sso-btn:hover{background:rgba(255,255,255,.09);border-color:rgba(255,255,255,.18);transform:translateY(-1px);}
    .lp-sso-btn svg{width:16px;height:16px;flex-shrink:0;}

    /* Alert box */
    .lp-alert{
      display:none;
      padding:12px 14px;border-radius:10px;
      font-size:13px;font-weight:600;line-height:1.4;
      margin-bottom:16px;
    }
    .lp-alert.is-error{background:rgba(255,60,60,.12);border:1px solid rgba(255,60,60,.25);color:#ff8080;}
    .lp-alert.is-success{background:rgba(74,222,128,.10);border:1px solid rgba(74,222,128,.22);color:#4ade80;}
    .lp-alert.is-visible{display:block;}

    /* Password strength */
    .lp-strength{margin-top:6px;}
    .lp-strength-bar{
      height:3px;border-radius:999px;
      background:rgba(255,255,255,.08);
      overflow:hidden;margin-bottom:4px;
    }
    .lp-strength-fill{height:100%;width:0;border-radius:999px;transition:width .3s,background .3s;}
    .lp-strength-text{font-size:11px;color:rgba(255,255,255,.30);font-weight:600;}

    .lp-form-footer{
      margin-top:24px;text-align:center;
      font-size:12px;color:rgba(255,255,255,.24);font-weight:500;line-height:1.7;
    }
    .lp-form-footer a{
      color:rgba(255,255,255,.46);font-weight:700;
      border-bottom:1px solid rgba(255,255,255,.16);transition:color .15s;
    }
    .lp-form-footer a:hover{color:rgba(255,255,255,.82);}

    /* Spinner */
    @keyframes spin{to{transform:rotate(360deg)}}
    .lp-spinner{
      width:16px;height:16px;border-radius:50%;
      border:2px solid rgba(0,0,0,.2);
      border-top-color:#0a0a0a;
      animation:spin .7s linear infinite;
      display:inline-block;
    }

    /* Mobile */
    @media(max-width:860px){
      .lp-root{grid-template-columns:1fr;}
      .lp-left{min-height:220px;display:block;}
      .lp-left-content{padding:24px 22px;min-height:220px;}
      .lp-left-quote blockquote{font-size:clamp(18px,5vw,28px);}
      .lp-right{min-height:unset;padding:32px 18px 48px;}
      .lp-topnav{margin-bottom:28px;}
    }
    @media(max-width:420px){
      .lp-right-inner{max-width:100%;}
      .lp-form-title{font-size:24px;}
      .lp-sso{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="lp-root">

    <!-- LEFT VISUAL -->
    <div class="lp-left">
      <div class="lp-left-img"></div>
      <div class="lp-left-overlay"></div>
      <div class="lp-left-content">
        <a class="lp-left-logo" href="index.html" aria-label="ICP — Accueil">
          <img src="assets/icp-logo.jpg" alt="ICP">
        </a>
        <div class="lp-left-quote">
          <blockquote>Born in basketball,<br/>powered by every sport.</blockquote>
          <p>Media &amp; creative platform driven by sport, culture and community.</p>
        </div>
        <div class="lp-left-badges">
          <span class="lp-badge"><span class="lp-badge-dot"></span>Women-Driven</span>
          <span class="lp-badge">Culture First</span>
          <span class="lp-badge">Multi-Sport</span>
          <span class="lp-badge">Production 360</span>
        </div>
      </div>
    </div>

    <!-- RIGHT FORM -->
    <div class="lp-right">
      <div class="lp-right-inner">

        <div class="lp-topnav">
          <a class="lp-back" href="index.html">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14"><path d="M10 3L5 8l5 5"/></svg>
            Retour
          </a>
          <span style="font-size:11px;font-weight:800;letter-spacing:.12em;text-transform:uppercase;color:rgba(255,255,255,.22);">ICP</span>
        </div>

        <!-- TABS -->
        <div class="lp-tabs" role="tablist">
          <button class="lp-tab is-active" id="tab-login" role="tab" aria-selected="true" aria-controls="panel-login">Connexion</button>
          <button class="lp-tab" id="tab-signup" role="tab" aria-selected="false" aria-controls="panel-signup">Créer un compte</button>
        </div>

        <!-- ══ PANEL LOGIN ══ -->
        <div class="lp-panel is-active" id="panel-login" role="tabpanel">

          <div class="lp-alert" id="login-alert"></div>

          <div class="lp-form-header">
            <p class="lp-eyebrow">Espace membre</p>
            <h1 class="lp-form-title">Bon retour<br/>chez vous.</h1>
            <p class="lp-form-sub">Connectez-vous à votre espace ICP.</p>
          </div>

          <form class="lp-form" id="form-login" novalidate>

            <div class="lp-field">
              <label class="lp-label" for="login-email">Email</label>
              <div class="lp-input-wrap">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16v16H4z"/><path d="M22 7l-10 7L2 7"/></svg>
                <input class="lp-input" id="login-email" name="email" type="email" placeholder="votre@email.com" autocomplete="email" required />
              </div>
            </div>

            <div class="lp-field">
              <label class="lp-label" for="login-password">Mot de passe</label>
              <div class="lp-input-wrap">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                <input class="lp-input" id="login-password" name="password" type="password" placeholder="••••••••" autocomplete="current-password" required />
                <button class="lp-eye" type="button" aria-label="Afficher le mot de passe" data-target="login-password">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
            </div>

            <div class="lp-options">
              <label class="lp-remember">
                <input type="checkbox" id="remember" checked>
                Se souvenir de moi
              </label>
              <a class="lp-forgot" href="#" id="forgot-link">Mot de passe oublié ?</a>
            </div>

            <button class="lp-submit" type="submit" id="login-btn">Se connecter</button>

          </form>

          <p class="lp-form-footer">
            En vous connectant, vous acceptez les <a href="#">CGU</a> d'ICP.<br/>
            <span style="opacity:.6;font-size:11px;">
              <a href="mentions-legales.html">Mentions légales</a> · <a href="rgpd.html">RGPD</a>
            </span>
          </p>
        </div>

        <!-- ══ PANEL SIGNUP ══ -->
        <div class="lp-panel" id="panel-signup" role="tabpanel">

          <div class="lp-alert" id="signup-alert"></div>

          <div class="lp-form-header">
            <p class="lp-eyebrow">Rejoindre ICP</p>
            <h1 class="lp-form-title">Créer votre<br/>compte.</h1>
            <p class="lp-form-sub">Accédez à l'espace membre ICP gratuitement.</p>
          </div>

          <form class="lp-form" id="form-signup" novalidate>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div class="lp-field">
                <label class="lp-label" for="signup-firstname">Prénom</label>
                <div class="lp-input-wrap">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                  <input class="lp-input" id="signup-firstname" name="firstname" type="text" placeholder="Prénom" autocomplete="given-name" required />
                </div>
              </div>
              <div class="lp-field">
                <label class="lp-label" for="signup-lastname">Nom</label>
                <div class="lp-input-wrap">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                  <input class="lp-input" id="signup-lastname" name="lastname" type="text" placeholder="Nom" autocomplete="family-name" required />
                </div>
              </div>
            </div>

            <div class="lp-field">
              <label class="lp-label" for="signup-email">Email</label>
              <div class="lp-input-wrap">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16v16H4z"/><path d="M22 7l-10 7L2 7"/></svg>
                <input class="lp-input" id="signup-email" name="email" type="email" placeholder="votre@email.com" autocomplete="email" required />
              </div>
            </div>

            <div class="lp-field">
              <label class="lp-label" for="signup-password">Mot de passe</label>
              <div class="lp-input-wrap">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                <input class="lp-input" id="signup-password" name="password" type="password" placeholder="8 caractères minimum" autocomplete="new-password" required />
                <button class="lp-eye" type="button" aria-label="Afficher le mot de passe" data-target="signup-password">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
              <div class="lp-strength" id="strength-box" style="display:none">
                <div class="lp-strength-bar"><div class="lp-strength-fill" id="strength-fill"></div></div>
                <span class="lp-strength-text" id="strength-text"></span>
              </div>
            </div>

            <div class="lp-field">
              <label class="lp-label" for="signup-confirm">Confirmer le mot de passe</label>
              <div class="lp-input-wrap">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                <input class="lp-input" id="signup-confirm" name="confirm" type="password" placeholder="Répétez le mot de passe" autocomplete="new-password" required />
                <button class="lp-eye" type="button" aria-label="Afficher" data-target="signup-confirm">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
            </div>

            <label class="lp-remember" style="margin-top:2px;">
              <input type="checkbox" id="signup-cgu" required>
              <span>J'accepte les <a href="#" style="color:rgba(255,255,255,.55);border-bottom:1px solid rgba(255,255,255,.2);">CGU</a> et la <a href="rgpd.html" style="color:rgba(255,255,255,.55);border-bottom:1px solid rgba(255,255,255,.2);">politique de confidentialité</a></span>
            </label>

            <button class="lp-submit" type="submit" id="signup-btn">Créer mon compte</button>

          </form>

          <p class="lp-form-footer">
            Déjà un compte ? <a href="#" id="switch-to-login">Se connecter</a><br/>
            <span style="opacity:.6;font-size:11px;">
              <a href="mentions-legales.html">Mentions légales</a> · <a href="rgpd.html">RGPD</a>
            </span>
          </p>
        </div>

      </div>
    </div>

  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="supabase-config.js"></script>

  <script>
  (function(){
    // ── Init Supabase ──────────────────────────────────────────
    const { createClient } = supabase;
    let sb;
    try {
      sb = createClient(window.__SUPABASE_URL, window.__SUPABASE_ANON_KEY);
    } catch(e) {
      console.warn('Supabase non configuré — mode démo');
    }

    // ── Tabs ───────────────────────────────────────────────────
    const tabLogin  = document.getElementById('tab-login');
    const tabSignup = document.getElementById('tab-signup');
    const panelLogin  = document.getElementById('panel-login');
    const panelSignup = document.getElementById('panel-signup');

    function switchTab(active) {
      const isLogin = active === 'login';
      tabLogin.classList.toggle('is-active', isLogin);
      tabSignup.classList.toggle('is-active', !isLogin);
      tabLogin.setAttribute('aria-selected', isLogin);
      tabSignup.setAttribute('aria-selected', !isLogin);
      panelLogin.classList.toggle('is-active', isLogin);
      panelSignup.classList.toggle('is-active', !isLogin);
    }
    tabLogin.addEventListener('click', () => switchTab('login'));
    tabSignup.addEventListener('click', () => switchTab('signup'));
    document.getElementById('switch-to-login')?.addEventListener('click', e => {
      e.preventDefault(); switchTab('login');
    });

    // ── Password toggle ────────────────────────────────────────
    document.querySelectorAll('.lp-eye').forEach(btn => {
      btn.addEventListener('click', () => {
        const inp = document.getElementById(btn.dataset.target);
        inp.type = inp.type === 'password' ? 'text' : 'password';
        btn.style.color = inp.type === 'text' ? 'rgba(255,255,255,.72)' : 'rgba(255,255,255,.26)';
      });
    });

    // ── Password strength ──────────────────────────────────────
    const pwdInput = document.getElementById('signup-password');
    const strengthBox  = document.getElementById('strength-box');
    const strengthFill = document.getElementById('strength-fill');
    const strengthText = document.getElementById('strength-text');

    pwdInput?.addEventListener('input', () => {
      const v = pwdInput.value;
      if (!v) { strengthBox.style.display = 'none'; return; }
      strengthBox.style.display = 'block';
      let score = 0;
      if (v.length >= 8)  score++;
      if (/[A-Z]/.test(v)) score++;
      if (/[0-9]/.test(v)) score++;
      if (/[^A-Za-z0-9]/.test(v)) score++;
      const levels = [
        { w:'25%',  bg:'#ef4444', label:'Faible' },
        { w:'50%',  bg:'#f97316', label:'Moyen' },
        { w:'75%',  bg:'#eab308', label:'Bon' },
        { w:'100%', bg:'#4ade80', label:'Fort' },
      ];
      const l = levels[Math.max(0, score - 1)];
      strengthFill.style.width = l.w;
      strengthFill.style.background = l.bg;
      strengthText.textContent = l.label;
      strengthText.style.color = l.bg;
    });

    // ── Alert helpers ──────────────────────────────────────────
    function showAlert(id, msg, type) {
      const el = document.getElementById(id);
      el.textContent = msg;
      el.className = `lp-alert is-visible is-${type}`;
    }
    function hideAlert(id) {
      const el = document.getElementById(id);
      el.className = 'lp-alert';
    }

    function setLoading(btnId, loading) {
      const btn = document.getElementById(btnId);
      btn.disabled = loading;
      btn.innerHTML = loading
        ? '<span class="lp-spinner"></span>'
        : btn.dataset.label || btn.textContent;
      if (!loading && !btn.dataset.label) btn.dataset.label = btn.textContent;
    }

    // ── Redirect si déjà connecté ──────────────────────────────
    if (sb) {
      sb.auth.getSession().then(({ data }) => {
        if (data?.session) window.location.href = 'dashboard.html';
      });
    }

    // ── LOGIN ──────────────────────────────────────────────────
    document.getElementById('form-login')?.addEventListener('submit', async e => {
      e.preventDefault();
      if (!sb) { showAlert('login-alert', '⚠️ Supabase non configuré. Remplis supabase-config.js', 'error'); return; }
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      hideAlert('login-alert');
      setLoading('login-btn', true);
      const { error } = await sb.auth.signInWithPassword({ email, password });
      setLoading('login-btn', false);
      if (error) {
        const msg = error.message.includes('Invalid') ? 'Email ou mot de passe incorrect.' : error.message;
        showAlert('login-alert', '❌ ' + msg, 'error');
      } else {
        showAlert('login-alert', '✅ Connexion réussie ! Redirection...', 'success');
        setTimeout(() => window.location.href = 'dashboard.html', 1200);
      }
    });

    // ── SIGNUP ─────────────────────────────────────────────────
    document.getElementById('form-signup')?.addEventListener('submit', async e => {
      e.preventDefault();
      if (!sb) { showAlert('signup-alert', '⚠️ Supabase non configuré. Remplis supabase-config.js', 'error'); return; }
      const firstname = document.getElementById('signup-firstname').value.trim();
      const lastname  = document.getElementById('signup-lastname').value.trim();
      const email     = document.getElementById('signup-email').value.trim();
      const password  = document.getElementById('signup-password').value;
      const confirm   = document.getElementById('signup-confirm').value;
      const cgu       = document.getElementById('signup-cgu').checked;

      hideAlert('signup-alert');

      if (!firstname || !lastname) { showAlert('signup-alert', '❌ Prénom et nom requis.', 'error'); return; }
      if (password.length < 8) { showAlert('signup-alert', '❌ Le mot de passe doit faire au moins 8 caractères.', 'error'); return; }
      if (password !== confirm)  { showAlert('signup-alert', '❌ Les mots de passe ne correspondent pas.', 'error'); return; }
      if (!cgu) { showAlert('signup-alert', '❌ Vous devez accepter les CGU.', 'error'); return; }

      setLoading('signup-btn', true);
      const { error } = await sb.auth.signUp({
        email, password,
        options: {
          data: { first_name: firstname, last_name: lastname, full_name: firstname + ' ' + lastname }
        }
      });
      setLoading('signup-btn', false);
      if (error) {
        showAlert('signup-alert', '❌ ' + error.message, 'error');
      } else {
        showAlert('signup-alert', '✅ Compte créé ! Vérifiez votre email pour confirmer.', 'success');
        document.getElementById('form-signup').reset();
      }
    });

    // ── FORGOT PASSWORD ────────────────────────────────────────
    document.getElementById('forgot-link')?.addEventListener('click', async e => {
      e.preventDefault();
      if (!sb) { alert('Supabase non configuré.'); return; }
      const email = document.getElementById('login-email').value.trim();
      if (!email) { showAlert('login-alert', '❌ Saisissez votre email pour réinitialiser.', 'error'); return; }
      const { error } = await sb.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin + '/login.html'
      });
      if (error) {
        showAlert('login-alert', '❌ ' + error.message, 'error');
      } else {
        showAlert('login-alert', '✅ Email de réinitialisation envoyé !', 'success');
      }
    });

    // ── GOOGLE OAuth ────────────────────────────────────────────
    async function signInWithGoogle() {
      if (!sb) { alert('Supabase non configuré.'); return; }
      const { error } = await sb.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin + '/dashboard.html' }
      });
      if (error) showAlert('login-alert', '❌ ' + error.message, 'error');
    }
    document.getElementById('google-login-btn')?.addEventListener('click', signInWithGoogle);
    document.getElementById('google-signup-btn')?.addEventListener('click', signInWithGoogle);

    // ── APPLE OAuth ─────────────────────────────────────────────
    async function signInWithApple() {
      if (!sb) { alert('Supabase non configuré.'); return; }
      const { error } = await sb.auth.signInWithOAuth({
        provider: 'apple',
        options: { redirectTo: window.location.origin + '/dashboard.html' }
      });
      if (error) showAlert('login-alert', '❌ ' + error.message, 'error');
    }
    document.getElementById('apple-login-btn')?.addEventListener('click', signInWithApple);
    document.getElementById('apple-signup-btn')?.addEventListener('click', signInWithApple);

  })();
  </script>
</body>
</html>
